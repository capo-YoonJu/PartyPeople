<template>
	<base-modal ref="baseModal">
		<div class="flex justify-center">
			<div class="w-full max-w-xs">
				<div class="bg-main-300 shadow-md rounded-xl px-8 pt-6 pb-8">
					<div
						class="flex justify-between items-start rounded-t border-none bg-main-300"
					>
						<svg
							class="ml-14 w-36 h-36 mr-5"
							version="1.1"
							id="Layer_1"
							xmlns="http://www.w3.org/2000/svg"
							xmlns:xlink="http://www.w3.org/1999/xlink"
							x="0px"
							y="0px"
							viewBox="0 0 511.984 511.984"
							style="enable-background: new 0 0 511.984 511.984"
							xml:space="preserve"
						>
							<g>
								<path
									style="fill: #434a54"
									d="M74.649,511.984c-2.18,0-4.383-0.672-6.281-2.062c-4.757-3.469-5.796-10.141-2.32-14.906
									l202.658-277.319c3.469-4.766,10.156-5.797,14.905-2.328c4.75,3.484,5.797,10.156,2.312,14.906L83.274,507.609
									C81.181,510.469,77.938,511.984,74.649,511.984z"
								/>
								<path
									style="fill: #434a54"
									d="M437.327,511.984c-3.297,0-6.531-1.516-8.625-4.375L226.044,230.274
									c-3.477-4.75-2.438-11.421,2.32-14.906c4.758-3.469,11.429-2.438,14.906,2.328l202.651,277.319
									c3.483,4.766,2.437,11.438-2.312,14.906C441.718,511.312,439.514,511.984,437.327,511.984z"
								/>
							</g>
							<g>
								<path
									style="fill: #656d78"
									d="M95.993,511.984H53.33c-5.898,0-10.671-4.781-10.671-10.672s4.773-10.672,10.671-10.672h42.663
									c5.89,0,10.664,4.781,10.664,10.672S101.883,511.984,95.993,511.984z"
								/>
								<path
									style="fill: #656d78"
									d="M458.654,511.984h-42.671c-5.891,0-10.672-4.781-10.672-10.672s4.781-10.672,10.672-10.672h42.671
									c5.89,0,10.655,4.781,10.655,10.672S464.544,511.984,458.654,511.984z"
								/>
							</g>
							<path
								style="fill: #e6e9ed"
								d="M447.982,223.993c0,106.028-85.966,191.993-191.994,191.993
								c-106.036,0-191.994-85.965-191.994-191.993c0-106.044,85.958-192.01,191.994-192.01C362.016,31.984,447.982,117.95,447.982,223.993
								z"
							/>
							<g>
								<path
									style="fill: #ed5564"
									d="M373.345,223.978c0,64.825-52.545,117.372-117.356,117.372
									c-64.818,0-117.355-52.547-117.355-117.372c0-64.811,52.537-117.356,117.355-117.356
									C320.8,106.622,373.345,159.167,373.345,223.978z"
								/>
								<path
									style="fill: #ed5564"
									d="M472.388,166.011l-30.873,8.265c4.25,16.016,6.468,32.687,6.468,49.718
									c0,17.015-2.218,33.686-6.468,49.702l30.873,8.281C482.513,244.024,482.513,203.947,472.388,166.011z"
								/>
							</g>
							<g>
								<path
									style="fill: #ffce54"
									d="M198.006,7.594l8.273,30.874c16.015-4.266,32.694-6.484,49.709-6.484
									c17.016,0,33.687,2.219,49.718,6.484l8.266-30.874C276.035-2.531,235.949-2.531,198.006,7.594z"
								/>
								<path
									style="fill: #ffce54"
									d="M313.971,440.377l-8.281-30.875c-16.016,4.266-32.687,6.484-49.702,6.484
									s-33.694-2.219-49.709-6.484l-8.273,30.875C235.949,450.502,276.019,450.502,313.971,440.377z"
								/>
							</g>
							<g>
								<path
									style="fill: #ed5564"
									d="M97.578,65.576l22.601,22.593c11.742-11.687,25.077-21.952,39.811-30.452
									c14.742-8.515,30.288-14.937,46.288-19.249l-8.265-30.874C160.085,17.797,125.375,37.827,97.578,65.576z"
								/>
								<path
									style="fill: #ed5564"
									d="M414.389,382.394L391.796,359.8c-11.733,11.703-25.077,21.953-39.812,30.453
									c-14.733,8.516-30.279,14.936-46.295,19.248l8.281,30.875C351.891,430.174,386.61,410.142,414.389,382.394z"
								/>
							</g>
							<g>
								<path
									style="fill: #ddce54"
									d="M39.596,166.011l30.874,8.265c4.312-15.999,10.734-31.545,19.25-46.279
									c8.508-14.75,18.757-28.077,30.46-39.827L97.578,65.576C69.838,93.372,49.8,128.075,39.596,166.011z"
								/>
								<path
									style="fill: #ddce54"
									d="M472.372,281.976l-30.873-8.281c-4.312,15.998-10.734,31.545-19.234,46.295
									c-8.516,14.734-18.766,28.062-30.468,39.811l22.593,22.594C442.139,354.597,462.185,319.896,472.372,281.976z"
								/>
							</g>
							<path
								style="fill: #ed5564"
								d="M39.596,281.976l30.874-8.281c-4.265-16.016-6.476-32.687-6.476-49.702
								c0-17.031,2.211-33.702,6.476-49.718l-30.874-8.265C29.472,203.947,29.472,244.024,39.596,281.976z"
							/>
							<g>
								<path
									style="fill: #ffce54"
									d="M97.578,382.394l22.601-22.594c-11.695-11.748-21.952-25.076-30.46-39.811
									c-8.507-14.75-14.929-30.297-19.25-46.295l-30.874,8.266C49.8,319.896,69.838,354.597,97.578,382.394z"
								/>
								<path
									style="fill: #ffce54"
									d="M414.405,65.576l-22.608,22.608c11.702,11.734,21.952,25.062,30.468,39.812
									c8.5,14.734,14.922,30.28,19.25,46.279l30.873-8.265C462.185,128.09,442.139,93.372,414.405,65.576z"
								/>
							</g>
							<g>
								<path
									style="fill: #ed5564"
									d="M198.012,440.377l8.273-30.875c-16.007-4.312-31.554-10.732-46.288-19.248
									c-14.742-8.5-28.077-18.75-39.819-30.453l-22.601,22.594C125.375,410.142,160.085,430.174,198.012,440.377z"
								/>
								<path
									style="fill: #ed5564"
									d="M313.971,7.594l-8.266,30.874c16,4.312,31.546,10.734,46.279,19.249
									c14.734,8.5,28.078,18.765,39.812,30.452l22.608-22.593C386.61,37.827,351.891,17.797,313.971,7.594z"
								/>
							</g>
							<path
								style="fill: #e6e9ed"
								d="M309.315,223.993c0,29.452-23.875,53.327-53.327,53.327s-53.334-23.875-53.334-53.327
								c0-29.468,23.882-53.342,53.334-53.342S309.315,194.526,309.315,223.993z"
							/>
							<path
								style="fill: #434a54"
								d="M255.988,234.649c-5.89,0-10.664-4.781-10.664-10.655V21.328c0-5.891,4.773-10.671,10.664-10.671
								c5.892,0,10.664,4.781,10.664,10.671v202.666C266.652,229.868,261.88,234.649,255.988,234.649z"
							/>
						</svg>
						<button
							type="button"
							@click="close()"
							class="text-tc-500 bg-alert-200 hover:bg-alert-100 hover:text-tc-500 rounded-full text-sm p-1.5 ml-auto inline-flex items-center dark:hover:bg-gray-600 dark:hover:text-white"
						>
							<svg
								class="w-5 h-5"
								fill="currentColor"
								viewBox="0 0 20 20"
								xmlns="http://www.w3.org/2000/svg"
							>
								<path
									fill-rule="evenodd"
									d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z"
									clip-rule="evenodd"
								></path>
							</svg>
						</button>
					</div>
					<!-- 룰렛 제목 -->
					<div class="mt-5">
						<input
							class="shadow appearance-none border rounded-full w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"
							id="username"
							type="text"
							placeholder="룰렛 제목을 입력해 주세요."
							v-model="rouletteTopic"
						/>
					</div>
					<div class="flex items-center justify-center mt-5">
						<button
							class="bg-gradient-to-r from-main-100 to-sub-100 text-white font-bold h-10 py-1 px-24 rounded-full focus:outline-none focus:shadow-outline"
							type="button"
							@click="rouletteStart"
						>
							START
						</button>
					</div>
				</div>
			</div>
		</div>
	</base-modal>
</template>

<style></style>

<script>
import BaseModal from './base-modal.vue';
import { ref } from 'vue';
import { useStore } from 'vuex';

export default {
	name: 'rouletteCreateModal',
	components: {
		BaseModal,
	},
	setup(props, { emit }) {
		const store = useStore();
		const baseModal = ref(null);
		const open = () => {
			console.log('roulette open');
			const sessionId = store.getters['root/getRoomId'];

			store
				.dispatch('root/requestRoomUserList', { roomId: sessionId })
				.then(res => {
					console.log('요청은 성공');

					const roomUserList = res.data.contents.reduce((acc, cur) => {
						acc.push({ value: `${cur.userid}/${cur.nickname}` });
						return acc;
					}, []);

					store.commit('root/setRoomUserList', roomUserList);
				})
				.catch(err => {
					console.log('실패');
					console.log(err);
				});

			baseModal.value.openModal();
		};
		const close = () => {
			baseModal.value.closeModal();
			emit('closeModal');
		};
		return { baseModal, open, close, store };
	},
	data() {
		return {
			rouletteTopic: '',
			itemNum: 0,
			items: {},
		};
	},
	methods: {
		plusItem() {
			this.itemNum++;
			console.log(this.itemNum);
		},
		minusItem() {
			this.itemNum--;
		},
		rouletteStart() {
			console.log('roulette start button clicked');

			const signalParticipants = this.store.getters['root/getRoomUserList'];
			const signalWinner = Math.floor(
				Math.random() * signalParticipants.length,
			);
			const signalData = {
				participants: signalParticipants,
				winner: signalWinner,
			};

			this.store.commit('root/setRouletteSignalData', signalData);
			this.$emit('sendRoulletteMessage', this.rouletteTopic);
			this.close();
		},
	},
};
</script>
